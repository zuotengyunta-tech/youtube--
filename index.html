<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ジョージ・メンズコーチ 動画一覧</title>

    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        .video {
            margin-bottom: 30px;
        }
        .video-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .loading {
            color: #666;
            font-size: 16px;
        }
    </style>
</head>
<body>

    <h1>ジョージ・メンズコーチ 動画一覧</h1>
    <div id="loading" class="loading">読み込み中...</div>
    <div id="videos"></div>

    <script>
        // ------------------------------------------------------
        // ここはあなたの情報。すでに差し替え済み
        // ------------------------------------------------------
        const API_KEY = "AIzaSyAxk1YpQSe-qDtFUSUmnjnduanag41Mlyk";
        const CHANNEL_ID = "UCGzxWLH1_1ABKKfSiy2MLAw";

        // ------------------------------------------------------
        // アップロード動画プレイリスト ID を取得
        // ------------------------------------------------------
        async function getUploadsPlaylistId() {
            const url =
                `https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id=${CHANNEL_ID}&key=${API_KEY}`;

            const res = await fetch(url);
            if (!res.ok) throw new Error("Channel fetch error: " + res.status);

            const data = await res.json();
            console.log("channel data:", data);

            if (!data.items || data.items.length === 0)
                throw new Error("Channel items is empty. API key or channel ID wrong?");

            return data.items[0].contentDetails.relatedPlaylists.uploads;
        }

        // ------------------------------------------------------
        // プレイリストから動画一覧を取得
        // ------------------------------------------------------
        async function getVideos(playlistId) {
            const url =
                `https://www.googleapis.com/youtube/v3/playlistItems?` +
                `part=snippet&maxResults=20&playlistId=${playlistId}&key=${API_KEY}`;

            const res = await fetch(url);
            if (!res.ok) throw new Error("Playlist fetch error: " + res.status);

            const data = await res.json();
            console.log("playlist data:", data);

            if (!data.items) return [];

            return data.items;
        }

        // ------------------------------------------------------
        // 画面に動画を描画
        // ------------------------------------------------------
        function render(videos) {
            const loading = document.getElementById("loading");
            const container = document.getElementById("videos");
            loading.textContent = "";
            container.innerHTML = "";

            videos.forEach(item => {
                const title = item.snippet.title;
                const videoId = item.snippet.resourceId.videoId;

                const div = document.createElement("div");
                div.className = "video";

                div.innerHTML = `
                    <div class="video-title">${title}</div>
                    <iframe width="560" height="315"
                        src="https://www.youtube.com/embed/${videoId}"
                        frameborder="0" allowfullscreen></iframe>
                `;

                container.appendChild(div);
            });
        }

        // ------------------------------------------------------
        // メイン処理
        // ------------------------------------------------------
        async function main() {
            try {
                const playlistId = await getUploadsPlaylistId();
                const videos = await getVideos(playlistId);
                render(videos);
            } catch (e) {
                console.error(e);
                document.getElementById("loading").textContent =
                    "動画の読み込みに失敗しました（詳細はコンソール）。";
            }
        }

        main();
    </script>

</body>
</html>
