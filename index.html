<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å®‰å…¨ãƒ»å®Œå…¨ç‰ˆ YouTube å‹•ç”»ãƒªã‚¹ãƒˆ</title>
  <style>
    .video-item {
      cursor: pointer;
      margin-bottom: 20px;
    }
    .video-item img {
      max-width: 100%;
      display: block;
    }
    iframe {
      width: 100%;
      max-width: 560px;
      height: 315px;
    }
  </style>
</head>

<body>
  <h1>å‹•ç”»ä¸€è¦§ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å†ç”Ÿï¼‰</h1>
  <div id="videos">èª­ã¿è¾¼ã¿ä¸­...</div>

  <script>
    // â–¼ â˜…ã“ã“ã«ã‚ãªãŸã®APIã‚­ãƒ¼ã‚’å…¥ã‚Œã¦ãã ã•ã„
    const API_KEY = "YOUR_API_KEY";

    // â–¼ â˜…ã“ã“ãŒã‚ãªãŸã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆID
    const PLAYLIST_ID = "PLExT6MVBKs2BOFn2KPX6FYLQ8btIpOZ5l";

    const container = document.getElementById("videos");

    //--------------------------------------------------------------------
    // ğŸ”¥ å®Œå…¨ç‰ˆï¼šå‹•ç”»è©³ç´°ã‚’ videoId ã‹ã‚‰å®‰å…¨ã«å–å¾—
    //--------------------------------------------------------------------
    async function getVideoData(videoId, apiKey) {
      const endpoint = "https://www.googleapis.com/youtube/v3/videos";
      const url = `${endpoint}?id=${videoId}&part=snippet,contentDetails,statistics&key=${apiKey}`;

      try {
        const res = await fetch(url);

        if (!res.ok) {
          console.error("HTTP Error:", res.status, res.statusText);
          return null;
        }

        const data = await res.json();

        if (data.error) {
          console.error("YouTube API Error:", data.error);
          return null;
        }

        // items ãŒç©º â†’ å‰Šé™¤ãƒ»éå…¬é–‹
        if (!data.items || data.items.length === 0) {
          console.warn(`å‹•ç”»ãŒå–å¾—ã§ãã¾ã›ã‚“ï¼ˆéå…¬é–‹ãƒ»å‰Šé™¤ãƒ»å­˜åœ¨ã—ãªã„ï¼‰: ${videoId}`);
          return null;
        }

        return data.items[0];

      } catch (e) {
        console.error("Fetch Exception:", e);
        return null;
      }
    }

    //--------------------------------------------------------------------
    // ğŸ”¥ è¤‡æ•°å‹•ç”»ã‚’å®‰å…¨ã«ã¾ã¨ã‚ã¦å–å¾—
    //--------------------------------------------------------------------
    async function fetchVideos(videoIds, apiKey) {
      const results = [];
      for (const id of videoIds) {
        const info = await getVideoData(id, apiKey);
        if (info !== null) {
          results.push(info);
        } else {
          console.log(`ã‚¹ã‚­ãƒƒãƒ—: ${id}`);
        }
      }
      return results;
    }

    //--------------------------------------------------------------------
    // ğŸ”¥ ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®å…¨ videoId ã‚’å®‰å…¨ã«å–å¾—ï¼ˆéå…¬é–‹ã§ã‚‚è½ã¡ãªã„ï¼‰
    //--------------------------------------------------------------------
    async function fetchAllVideoIds(pageToken = "", ids = []) {
      const url =
        `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet` +
        `&maxResults=50&playlistId=${PLAYLIST_ID}&key=${API_KEY}&pageToken=${pageToken}`;

      try {
        const res = await fetch(url);
        const data = await res.json();

        if (data.error) {
          console.error("Playlist API Error:", data.error);
          return ids;
        }

        if (data.items) {
          data.items.forEach(item => {
            const videoId = item.snippet?.resourceId?.videoId;
            if (videoId) ids.push(videoId);
            else console.log("éå…¬é–‹ãƒ»å‰Šé™¤ã§ videoId ãªã— â†’ ã‚¹ã‚­ãƒƒãƒ—");
          });
        }

        if (data.nextPageToken) {
          return fetchAllVideoIds(data.nextPageToken, ids);
        }

      } catch (e) {
        console.error("Fetch playlist exception:", e);
      }

      return ids;
    }

    //--------------------------------------------------------------------
    // ğŸ”¥ åˆæœŸèª­ã¿è¾¼ã¿ï¼ˆå®Œå…¨å®‰å…¨ç‰ˆï¼‰
    //--------------------------------------------------------------------
    (async () => {
      container.innerHTML = "å‹•ç”»èª­è¾¼ä¸­...";

      // 1. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‹ã‚‰ videoId å…¨å–å¾—
      const videoIds = await fetchAllVideoIds();

      if (!videoIds.length) {
        container.innerHTML = "å‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆéå…¬é–‹ã®ã¿ï¼Ÿï¼‰";
        return;
      }

      // 2. videoId â†’ è©³ç´°ãƒ‡ãƒ¼ã‚¿å–å¾—
      const videos = await fetchVideos(videoIds, API_KEY);

      if (!videos.length) {
        container.innerHTML = "å–å¾—ã§ãã‚‹å‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆå…¨éƒ¨éå…¬é–‹ï¼Ÿï¼‰";
        return;
      }

      container.innerHTML = "";

      // 3. HTMLãƒªã‚¹ãƒˆã¨ã—ã¦è¡¨ç¤º
      videos.forEach(v => {
        const title = v.snippet.title;
        const videoId = v.id;
        const thumbnail = v.snippet.thumbnails.medium.url;

        const div = document.createElement("div");
        div.className = "video-item";

        div.innerHTML = `
          <img src="${thumbnail}" alt="${title}" loading="lazy" />
          <p>${title}</p>
        `;

        div.onclick = () => {
          div.innerHTML = `
            <iframe src="https://www.youtube.com/embed/${videoId}?rel=0"
              frameborder="0"
              allowfullscreen
              loading="lazy">
            </iframe>
          `;
        };

        container.appendChild(div);
      });
    })();

  </script>
</body>
</html>
