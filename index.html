<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ジョージ・メンズコーチ 動画一覧</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #videos { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 20px; }
    .video-item { cursor: pointer; border: 1px solid #ddd; padding: 10px; border-radius: 8px; transition: transform 0.1s; background: #fafafa; }
    .video-item:hover { transform: scale(1.02); }
    .video-item img { width: 100%; border-radius: 6px; }
    iframe { width: 100%; max-width: 560px; height: 315px; margin-top: 20px; }
    h2 { margin-bottom: 10px; }
  </style>
</head>
<body>

<h2>ジョージ・メンズコーチ（@coachjoji）動画一覧</h2>
<div id="player"></div>
<div id="videos">読み込み中...</div>

<script>
  const apiKey = "AIzaSyAxk1YpQSe-qDtFUSUmnjnduanag41Mlyk"; // ← APIキー
  const channelId = "UCdWidthlZJ8xk5mVL6f3QyAg"; // ← 正しいチャンネルID

  const container = document.getElementById("videos");
  const player = document.getElementById("player");

  // アップロード動画リストの playlistId を取得
  async function getUploadsPlaylistId() {
    const url = `https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id=${channelId}&key=${apiKey}`;
    const res = await fetch(url);
    const data = await res.json();

    if (!res.ok) throw new Error(data.error?.message || "API error");
    return data.items[0].contentDetails.relatedPlaylists.uploads;
  }

  // playlistId から全動画取得
  async function fetchAllVideos(playlistId, pageToken = "", allItems = []) {
    const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${apiKey}&pageToken=${pageToken}`;
    const res = await fetch(url);
    const data = await res.json();

    if (!res.ok) throw new Error(data.error?.message || "API fetch error");

    if (data.items) allItems = allItems.concat(data.items);
    if (data.nextPageToken) return fetchAllVideos(playlistId, data.nextPageToken, allItems);
    return allItems;
  }

  // 実行
  getUploadsPlaylistId()
    .then(playlistId => fetchAllVideos(playlistId))
    .then(items => {
      container.innerHTML = "";
      if (items.length === 0) {
        container.innerHTML = "動画がありません。";
        return;
      }

      items.forEach(item => {
        const title = item.snippet.title;
        const videoId = item.snippet.resourceId?.videoId;
        if (!videoId) return;

        const thumbnail = item.snippet.thumbnails?.medium?.url || "";

        const div = document.createElement("div");
        div.className = "video-item";

        div.innerHTML = `
          <img src="${thumbnail}" alt="${title}" />
          <p>${title}</p>
        `;

        div.onclick = () => {
          player.innerHTML = `
            <iframe
              src="https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1&autoplay=1"
              allow="autoplay; encrypted-media"
              allowfullscreen
            ></iframe>
          `;
          window.scrollTo({ top: 0, behavior: "smooth" });
        };

        container.appendChild(div);
      });
    })
    .catch(err => {
      container.innerText = "APIエラー: " + err.message;
      console.error(err);
    });
</script>

</body>
</html>
